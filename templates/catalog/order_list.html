{% extends 'catalog/base.html' %}
{% block title %}Заказы — Обувной бутик{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h2><i class="bi bi-receipt me-2"></i>Заказы</h2>
</div>
<div class="mb-3">
    <form method="get" class="d-flex gap-2">
        <input type="text" name="q" class="form-control" placeholder="Поиск по ФИО, артикулу..." value="{{ query }}">
        <button type="submit" class="btn btn-primary"><i class="bi bi-search"></i></button>
        {% if query %}<a href="{% url 'order_list' %}" class="btn btn-outline-secondary"><i class="bi bi-x"></i></a>{% endif %}
    </form>
</div>
<div class="table-responsive">
    <table class="table table-bordered table-hover align-middle">
        <thead class="table-primary">
            <tr>
                <th>№</th>
                <th>Артикул</th>
                <th>ФИО клиента</th>
                <th>Дата заказа</th>
                <th>Дата доставки</th>
                <th>Пункт выдачи</th>
                <th>Код</th>
                <th>Статус</th>
                {% if user.can_edit_orders %}<th class="text-center">Действия</th>{% endif %}
            </tr>
        </thead>
        <tbody>
            {% for order in orders %}
            <tr>
                <td><strong>{{ order.number }}</strong></td>
                <td><code>{{ order.article }}</code></td>
                <td>{{ order.client_name }}</td>
                <td>{{ order.order_date }}</td>
                <td>{{ order.delivery_date|default:"—" }}</td>
                <td>{{ order.delivery_point|default:"—" }}</td>
                <td><code>{{ order.pickup_code }}</code></td>
                <td>
                    {% if order.status == 'new' %}<span class="badge bg-primary">{{ order.get_status_display }}</span>
                    {% elif order.status == 'completed' %}<span class="badge bg-success">{{ order.get_status_display }}</span>
                    {% else %}<span class="badge bg-secondary">{{ order.get_status_display }}</span>{% endif %}
                </td>
                {% if user.can_edit_orders %}
                <td class="text-center text-nowrap">
                    <a href="{% url 'order_edit' order.pk %}" class="btn btn-sm btn-outline-primary me-1"><i class="bi bi-pencil"></i></a>
                    <a href="{% url 'order_delete' order.pk %}" class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></a>
                </td>
                {% endif %}
            </tr>
            {% empty %}
            <tr><td colspan="9" class="text-center text-muted py-4">Заказы не найдены</td></tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<p class="text-muted small">Всего: {{ orders|length }}</p>
{% endblock %}
